from androguard.core.bytecodes import dvm
from androguard.core.analysis import analysis
from androguard.misc import AnalyzeAPK, AnalyzeDex
from deepdiff import DeepDiff
import json,os

import argparse


def analyze(apk_path):
    json_info = {}
    a,d,dx = AnalyzeAPK(apk_path)
    json_info["Name"] = a.get_app_name()
    json_info["is_signed"] = a.is_signed()
    #json_info["Certificate"] = a.get_certificate_der(a.get_signature_name())
    json_info["permissions"] = a.get_permissions()
    json_info["Classes"] = a.get_activities()

    #print(dx.get_classes())

    return json_info

def dir_path(string):
    if os.path.isdir(string):
        return string
    else:
        raise NotADirectoryError(string)

if __name__ == "__main__":
    parser = argparse.ArgumentParser(description='Process some integers.')
    parser.add_argument('-n', '--names-list', nargs='+', default=[])
    parser.add_argument('--path', type=dir_path)

    args = parser.parse_args()

    #print(args.names-list)

    json1 = analyze("Minecraft-1.18.12.01.apk")
    json2 = analyze("rusa.apk")
    #json3 = analyze("Minecraft-1.18.12.012.apk")
    output = DeepDiff(json1, json2, ignore_order=True)
    print(json1)
    print(json2)
    #output2 = DeepDiff(json1, json3, ignore_order=True)
    with open('output.json', 'w') as outfile:
        json.dump(output, outfile)
    #with open('output_2.json', 'w') as outfile:
    #    json.dump(output2, outfile)
    print(output)
    #print(output2)


    #h, d, dx = AnalyzeDex("Minecraft-1.18.12.01.apk")
    #print(h)
    #print(d)
    #print(dx)